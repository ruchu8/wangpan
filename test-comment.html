<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>留言测试</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>留言测试</h1>
        
        <div class="comment-form">
            <h3>发表留言</h3>
            <form id="commentForm">
                <div class="form-group">
                    <label for="contactType">联系方式类型 <span class="required">*</span></label>
                    <select id="contactType" class="form-control" required>
                        <option value="">请选择联系方式类型</option>
                        <option value="QQ">QQ</option>
                        <option value="微信">微信</option>
                        <option value="邮箱">邮箱</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="contactInfo">联系方式 <span class="required">*</span></label>
                    <input type="text" id="contactInfo" class="form-control" placeholder="请输入您的QQ号/微信号/邮箱地址" required>
                </div>
                <div class="form-group">
                    <label for="commentContent">留言内容 <span class="required">*</span></label>
                    <textarea id="commentContent" rows="4" class="form-control" required></textarea>
                </div>
                <button type="submit" class="submit-btn">提交留言</button>
            </form>
            <div id="commentStatus" class="comment-status"></div>
        </div>
        
        <div class="comments-section">
            <h3>留言列表</h3>
            <div class="comments-list" id="commentsList"></div>
        </div>
    </div>
    
    <script>
        // 显示留言状态
        function showCommentStatus(message, type) {
            const statusElement = document.getElementById('commentStatus');
            statusElement.textContent = message;
            statusElement.className = 'comment-status ' + type;
            
            setTimeout(() => {
                statusElement.className = 'comment-status';
            }, 3000);
        }
        
        // 提交留言
        async function submitComment(event) {
            event.preventDefault();
            
            const contactType = document.getElementById('contactType').value;
            const contactInfo = document.getElementById('contactInfo').value;
            const content = document.getElementById('commentContent').value;
            const statusElement = document.getElementById('commentStatus');
            
            if (!contactType || !contactInfo || !content) {
                showCommentStatus('请填写完整信息', 'error');
                return;
            }
            
            // 组合联系方式显示名称
            const name = `${contactType}:${contactInfo}`;
            
            try {
                const response = await fetch('/api/comments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, content })
                });
                
                if (response.ok) {
                    document.getElementById('commentForm').reset();
                    showCommentStatus('留言提交成功，等待审核后显示', 'success');
                } else {
                    const error = await response.json();
                    showCommentStatus(error.error || '提交失败', 'error');
                }
            } catch (error) {
                console.error('Error submitting comment:', error);
                showCommentStatus('提交失败，请稍后再试', 'error');
            }
        }
        
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 添加留言表单提交事件
            document.getElementById('commentForm').addEventListener('submit', submitComment);
        });
    </script>
</body>
</html>